<%- include('../partials/head') %>
<%- include('../partials/navbar') %>

<main class="page tests-page" data-aos="fade-up">
  <section class="section">
    <div class="section-inner">
      <h1 class="section-title">Stars uchun testlar</h1>

      <div class="card" style="margin-bottom:16px;">
        <h2 style="font-size:18px;margin-bottom:6px;">Qonun-qoidalar</h2>
        <ul style="font-size:14px;color:#275546;margin-left:18px;margin-bottom:6px;">
          <li>Bu yerda faqat stars (yulduzlar) uchun ajratilgan maxsus testlar joylashadi.</li>
          <li>Har bir stars uchun testni <strong>faqat bir marta</strong> va <strong>faqat vaqtli (timerli)</strong> rejimda yechishingiz mumkin.</li>
          <li>Yopiq savollar (A/B/C/D) va ochiq savollar uchun umumiy savollar soni va timer ko'rsatiladi.</li>
          <li>Vaqt bilan yechilgan (timed) urinishlar stars bo'yicha yetakchilar reytingiga va mukofotlarga ta'sir qiladi.</li>
        </ul>
        <p style="font-size:13px;color:#56756a;">Diqqat: har bir stars testi bo'yicha faqat bitta urinish beriladi. Boshlashdan oldin tayyor ekanligingizga ishonch hosil qiling.</p>
      </div>

      <div class="tests-layout">
        <div class="tests-list card">
          <h2 class="tests-list-title">Stars uchun testlar ro'yxati</h2>
          <p class="tests-list-desc">Quyidagi ro'yxatdan bir testni tanlab, vaqtsiz (faqat bir marotaba) rejimda yeching.</p>

          <div class="tests-cards">
            <% if (tests && tests.length) { %>
              <% tests.forEach(function(t, idx){ %>
                <div class="test-card-btn" style="cursor:default;">
                  <div class="test-card-rank">#<%= idx + 1 %></div>
                  <div class="test-card-main">
                    <div class="test-card-title"><%= t.title %></div>
                    <div class="test-card-meta">
                      <% if (typeof t.totalQuestions !== 'undefined' && t.totalQuestions !== null) { %>
                        <span><%= t.totalQuestions %> ta savol
                          <% if (typeof t.closedCount !== 'undefined' && t.closedCount !== null) { %>
                            Â· <%= t.closedCount %> ta yopiq (A/B/C/D) savol
                          <% } %>
                        </span>
                      <% } %>
                      <% if (typeof t.timerMinutes === 'number' && t.timerMinutes > 0) { %>
                        <span style="margin-left:8px;">Â· <%= t.timerMinutes %> daqiqa tavsiya etilgan vaqt</span>
                      <% } %>
                      <% if (t.starStartDate || t.starEndDate) { %>
                        <span style="display:block;font-size:12px;color:#56756a;margin-top:2px;">
                          Stars uchun muddat:
                          <% if (t.starStartDate) { %>
                            <%= t.starStartDate.toLocaleDateString('uz-UZ') %>
                          <% } %>
                          â€”
                          <% if (t.starEndDate) { %>
                            <%= t.starEndDate.toLocaleDateString('uz-UZ') %>
                          <% } %>
                        </span>
                      <% } %>
                    </div>
                  </div>
                  <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;">
                    <% if (t.isLocked) { %>
                      <button
                        type="button"
                        class="btn-outline"
                        disabled
                        style="display:flex;align-items:center;gap:6px;opacity:0.8;cursor:not-allowed;"
                      >
                        <span style="font-size:16px;">ðŸ”’</span>
                        <span>Test hali boshlanmagan</span>
                      </button>
                      <small style="font-size:11px;color:#b35a00;max-width:220px;text-align:right;">
                        Belgilangan sana va vaqt kelgach qulf ochiladi va testni yechishingiz mumkin bo'ladi.
                      </small>
                    <% } else { %>
                      <button
                        type="button"
                        class="btn-primary"
                        onclick="window.location.href='/tests/<%= t._id %>?mode=timed'"
                        style="display:flex;align-items:center;gap:6px;"
                      >
                        <span class="star-unlock-icon" style="font-size:16px;">ðŸ”“</span>
                        <span>Testni vaqt bilan boshlash</span>
                      </button>
                      <small style="font-size:11px;color:#b35a00;max-width:220px;text-align:right;">
                        Diqqat: bu stars testini faqat <strong>bitta marta</strong> vaqtli rejimda yechishingiz mumkin.
                      </small>
                    <% } %>
                  </div>
                </div>
              <% }); %>
            <% } else { %>
              <p class="tests-empty">Hozircha stars uchun testlar ochilmagan.</p>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<%- include('../partials/footer') %>
